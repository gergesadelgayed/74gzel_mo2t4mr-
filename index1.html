<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="description" content="Ù…Ù†ØµØ© Ø­Ø¬Ø² ÙˆØ¥Ø¯Ø§Ø±Ø© Ù…Ø¤ØªÙ…Ø±Ø§Øª â€” ØªØµÙ…ÙŠÙ… Ø¹ØµØ±ÙŠ Ø£Ø²Ø±Ù‚ØŒ Ø­Ø¬Ø² Ø³Ø±ÙŠØ¹ØŒ ØªØ°Ø§ÙƒØ± PDFØŒ ÙˆØ¯Ø¹Ù… Ù…Ø­Ù„ÙŠ.">

  <title>Ù…Ù†ØµØ© Ø­Ø¬Ø² Ø§Ù„Ù…Ø¤ØªÙ…Ø±Ø§Øª â€” Ø¥Ø¯Ø§Ø±Ø© ÙˆØ­Ø¬Ø² Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª</title>

  <!-- Fonts & Icons -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <!-- Arcade Hacker Font -->
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

  <style>
    :root{ --primary:#1e4fff; --primary-dark:#1539c7; --bg:#f4f8ff; --muted:#51617a; --card-bg:#fff; --text:#0f1b3d; --glass: rgba(255,255,255,0.7);} 
    [data-theme="dark"]{ --bg:#071028; --card-bg:rgba(10,20,30,0.7); --text:#e6eef6; --muted:#9fb4c9; --glass: rgba(7,16,40,0.5);} 
    *{box-sizing:border-box} body{ background:linear-gradient(180deg,var(--bg),#eaf2ff); color:var(--text); font-family:Inter,Segoe UI,Tahoma,Arial; margin:0; -webkit-font-smoothing:antialiased; }
    header{ padding:14px 0; border-bottom:1px solid rgba(0,0,0,0.04); backdrop-filter: blur(6px); }
    .brand{ display:flex; gap:12px; align-items:center; color:var(--primary-dark); font-weight:800; }
    .card{ background:var(--card-bg); border:none; border-radius:12px; box-shadow:0 10px 30px rgba(16,24,40,0.06); }
    .btn-primary{ background:linear-gradient(90deg,var(--primary),var(--primary-dark)); color:#fff; border:none; }
    .event-thumb{ width:100%; height:160px; object-fit:cover; border-radius:10px; background:#eee; display:block; }
    .badge-cap{ background:#eef6ff; color:var(--primary-dark); padding:.25rem .5rem; border-radius:.5rem; font-weight:700; }
    .muted-small{ color:var(--muted); font-size:13px; }
    .tag{ background:#eef6ff; padding:.18rem .45rem; border-radius:.5rem; color:var(--primary-dark); font-weight:700; font-size:12px; }
    .floating-whatsapp{ position:fixed; bottom:22px; right:22px; left:auto; z-index:1050; border-radius:50%; width:60px; height:60px; display:flex; align-items:center; justify-content:center; background:linear-gradient(90deg,#25D366,#12a554); color:#fff; font-size:24px; box-shadow:0 8px 24px rgba(16,24,40,0.18); text-decoration:none; }
    .floating-whatsapp small{ display:block; font-size:10px; line-height:1; text-align:center; margin-top:2px; }

    /* improved countdown */
    .countdown-box{ padding:10px; border-radius:10px; background:linear-gradient(90deg, rgba(30,79,255,0.06), rgba(21,57,199,0.03)); }
    .progress-heat{ height:8px; background:linear-gradient(90deg, rgba(0,0,0,0.05), rgba(0,0,0,0.02)); border-radius:6px; overflow:hidden; }
    .progress-heat > div{ height:8px; background:linear-gradient(90deg,var(--primary),var(--primary-dark)); width:0%; transition:width .8s ease; }

    /* calendar grid tweaks */
    .cal-day{ min-height:92px; padding:8px; border-radius:8px; border:1px dashed rgba(0,0,0,0.03); background:var(--glass); }

    /* subtle animations */
    .fade-in{ animation:fadeIn .45s ease both; } @keyframes fadeIn{ from{opacity:0; transform:translateY(6px)} to{opacity:1; transform:none} }
    .fade-up{ animation: fadeUp 0.6s ease both; } @keyframes fadeUp{ from{opacity:0; transform:translateY(8px);} to{opacity:1; transform:none;} }

    /* admin panel animations & neon mode */
    .admin-panel{opacity:0; transform:translateY(10px); transition:all .35s cubic-bezier(.2,.9,.25,1); }
    .admin-panel.show{opacity:1; transform:translateY(0); }
    .admin-panel .card{ transition: transform .18s ease, box-shadow .18s ease; }
    .admin-panel .card:hover{ transform: translateY(-4px); box-shadow:0 18px 40px rgba(16,24,40,0.08); }

    /* Hacker neon theme */
    body.neon { background: linear-gradient(180deg,#00110a,#02120a); color:#bfffbf; }
    body.neon .card { background: rgba(0,0,0,0.45); border:1px solid rgba(57,255,20,0.07); box-shadow: 0 6px 30px rgba(0,0,0,0.6); }
    body.neon a#madeBy { color:#39ff14; text-shadow:0 0 8px rgba(57,255,20,0.22); }
    body.neon .event-thumb { filter: contrast(1.05) saturate(1.05); border:1px solid rgba(57,255,20,0.04); }
    body.neon .badge-cap, body.neon .tag { background: rgba(57,255,20,0.06); color:#bfffbf; }

    /* accessibility */
    :focus{ outline:3px solid rgba(30,79,255,0.18); outline-offset:2px; }
    @media (max-width:991px){ .event-thumb{ height:140px; } .chat-box{ right:12px; width:88%; } }

    /* Utility: visible on keyboard focus */
    .visually-hidden-focusable { position: absolute; left: -9999px; top: auto; width: 1px; height: 1px; overflow: hidden; }
    .visually-hidden-focusable:focus, .visually-hidden-focusable:active { position: static; width: auto; height: auto; left: auto; clip: auto; margin: 8px; z-index: 9999; background:#fff; padding:8px 12px; border-radius:6px; box-shadow:0 8px 30px rgba(16,24,40,0.12); color:var(--primary-dark); }
    a.floating-whatsapp[aria-label]{ box-shadow: 0 8px 24px rgba(37,211,102,0.12); transition: transform .15s ease; }
    a.floating-whatsapp:hover{ transform: translateY(-4px) scale(1.03); }

    footer{ padding:18px 0; border-top:1px solid rgba(0,0,0,0.04); margin-top:28px; }
    footer .made-center{ text-align:center; display:block; width:100%; margin-top:6px; font-weight:700; }

    /* Hacker arcade font for 'Made by' */
    .hacker-font { font-family:'Press Start 2P', monospace; font-size:12px; color:#be0bf5; text-shadow:0 0 6px #00ff00; }
    /* visually hide but keep accessible for screen readers and keyboard (hidden but focusable) */
    .sr-only {
      position: absolute !important;
      width: 1px !important;
      height: 1px !important;
      padding: 0 !important;
      margin: -1px !important;
      overflow: hidden !important;
      clip: rect(0 0 0 0) !important;
      white-space: nowrap !important;
      border: 0 !important;
    }

    /* Verse box */
    #serviceVerse {
      background:#007599;
      padding:12px;
      border-radius:8px;
      text-align:center;
      font-weight:700;
      margin:12px auto;
      color: #d4af37;
      max-width:980px;
      font-size:15px;
    }

  </style>
</head>
<body>
<a id="skipLink" class="visually-hidden-focusable" href="#maincontent">ØªØ®Ø·ÙŠ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø­ØªÙˆÙ‰</a>

  <header class="container d-flex justify-content-between align-items-center">
    <div class="d-flex align-items-center gap-3">
      <div class="brand" aria-hidden="false"><span style="font-size:22px;color:var(--primary)">âœ¦</span>
        <div>
          <div style="font-size:18px" id="brandTitle">Ù…Ù†ØµØ© Ø­Ø¬Ø² Ø§Ù„Ù…Ø¤ØªÙ…Ø±Ø§Øª</div>
          <div class="muted-small">Ù…Ù†ØµØ© Ù…ØªØ·ÙˆØ±Ø© Ù„Ø¥Ø¯Ø§Ø±Ø© ÙˆØ­Ø¬Ø² Ø§Ù„Ù…Ø¤ØªÙ…Ø±Ø§Øª</div>
        </div>
      </div>
    </div>

    <div class="d-flex gap-2 align-items-center">
      <select id="langSelect" class="form-select form-select-sm" style="width:110px" aria-label="Ø§Ø®ØªØ± Ø§Ù„Ù„ØºØ©">
        <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
        <option value="en">English</option>
      </select>
      <button id="darkToggle" class="btn btn-sm btn-outline-secondary" aria-pressed="false"><i class="bi bi-moon-stars"></i> ÙˆØ¶Ø¹</button>
      <button id="btnLogin" class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#authModal" aria-haspopup="dialog"><i class="bi bi-person"></i> <span id="loginLabel">Ø¯Ø®ÙˆÙ„</span></button>
    </div>
  </header>

  <!-- RANDOM SERVICE VERSE BOX (shows random verse each page load) -->
  <div id="serviceVerse" role="region" aria-live="polite">ØªØ­Ù…ÙŠÙ„...</div>

  <main id="maincontent" class="container my-4">
    <div class="row g-4">
      <section class="col-12 col-lg-8">
        <div class="card p-3 mb-3 fade-in" role="region" aria-label="Ø§Ù„Ø£Ø­Ø¯Ø§Ø«">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <div>
              <h4 class="mb-0" style="color:var(--primary-dark)" id="eventsTitle">Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</h4>
              <div class="small-muted" id="eventsSubtitle">Ø§Ø¨Ø­Ø«ØŒ ØµÙÙ‘ØŒ ÙˆØ­Ø¬Ø² Ø¨ÙƒÙ„ Ø³Ù‡ÙˆÙ„Ø©</div>
            </div>
            <div class="d-flex gap-2">
              <input id="searchInput" class="form-control form-control-sm" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ø­Ø¯Ø«..." style="min-width:220px" aria-label="Ø¨Ø­Ø« Ø¹Ù† Ø­Ø¯Ø«">
              <select id="sortSelect" class="form-select form-select-sm" style="width:160px" aria-label="ØªØ±ØªÙŠØ¨ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«">
                <option value="date">ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ®</option>
                <option value="remaining">ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</option>
                <option value="price_desc">Ø§Ù„Ø³Ø¹Ø± ØªÙ†Ø§Ø²Ù„ÙŠ</option>
              </select>
            </div>
          </div>

          <div id="nextEventCountdown" class="countdown-box mb-3 d-flex justify-content-between align-items-center" role="status" aria-live="polite">
            <div id="countdownText">â³ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ...</div>
            <div style="width:50%;">
              <div class="progress-heat" role="progressbar" aria-valuemin="0" aria-valuemax="100"><div id="countdownProgress" style="width:0%"></div></div>
            </div>
          </div>

          <div id="eventsGrid" class="row g-3 mt-2" aria-live="polite"></div>
        </div>

        <div class="card p-3 mb-3 fade-in" id="galleryCard">
          <div class="card-body">
            <h6 style="color:var(--primary-dark)" id="galleryTitle">Ù…Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±</h6>
            <div class="row g-2 gallery" id="galleryGrid" aria-live="polite"></div>
          </div>
        </div>

        <div class="card p-3 fade-in">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <h6 style="color:var(--primary-dark)" id="calTitleLabel">Ø§Ù„ØªÙ‚ÙˆÙŠÙ…</h6>
              <div>
                <button id="calPrev" class="btn btn-sm btn-outline-secondary" aria-label="Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø³Ø§Ø¨Ù‚"><i class="bi bi-chevron-left"></i></button>
                <span id="calTitle" class="mx-2 small-muted" aria-live="polite"></span>
                <button id="calNext" class="btn btn-sm btn-outline-secondary" aria-label="Ø§Ù„Ø´Ù‡Ø± Ø§Ù„ØªØ§Ù„ÙŠ"><i class="bi bi-chevron-right"></i></button>
              </div>
            </div>
            <div id="calendarGrid" class="row g-2" role="grid"></div>
          </div>
        </div>
      </section>

      <aside class="col-12 col-lg-4">
        <div class="card p-3 mb-3 fade-in">
          <div class="card-body">
            <h5 style="color:var(--primary-dark)"><i class="bi bi-ticket-perforated"></i> <span id="bookingTitle">Ø§Ø­Ø¬Ø² Ø­Ø¶ÙˆØ± Ù…Ø¤ØªÙ…Ø±</span></h5>
            <form id="bookingForm" class="row g-2" aria-label="Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø­Ø¬Ø²" method="post" action="#">
              <div class="col-12">
                <label class="form-label">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¤ØªÙ…Ø± <span class="text-danger">*</span></label>
                <select id="selectEvent" class="form-select" required aria-required="true"></select>
              </div>
              <div class="col-12"><label class="form-label">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ <span class="text-danger">*</span></label><input id="bk_name" class="form-control" required></div>
              <div class="col-12"><label class="form-label">Ø§Ù„Ù‡Ø§ØªÙ <span class="text-danger">*</span></label><input id="bk_phone" class="form-control" type="tel" required></div>

              <div class="col-12"><button class="btn btn-primary w-100" type="submit"><i class="bi bi-cart-check"></i> <span id="bookNowLabel">Ø§Ø­Ø¬Ø² Ø§Ù„Ø¢Ù†</span></button></div>
            </form>
            <p class="muted-small mt-2">Ø¨Ø¹Ø¯ Ø§Ù„Ø­Ø¬Ø² Ø³ØªØ¸Ù‡Ø± Ù„Ùƒ ØªØ°ÙƒØ±Ø© Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ­Ù…ÙŠÙ„ ÙˆØ¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø±.</p>
          </div>
        </div>

        <div class="card p-3 mb-3 fade-in" id="quickRegisterCard" aria-live="polite">
          <div class="card-body">
            <h6 style="color:var(--primary-dark)">Ø§Ù†Ø¶Ù… Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</h6>
            <form id="quickRegister" class="row g-2" aria-label="ØªØ³Ø¬ÙŠÙ„ Ø³Ø±ÙŠØ¹">
              <div class="col-12"><input id="qr_name" class="form-control" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„" required></div>
              <div class="col-12"><input id="qr_phone" class="form-control" placeholder="Ø§Ù„Ù‡Ø§ØªÙ" required></div>
              <div class="col-12"><button class="btn btn-primary w-100" type="submit">Ø§Ù†Ø¶Ù… Ø§Ù„Ø¢Ù†</button></div>
            </form>
            <p class="muted-small mt-2">Ø³ØªØªÙ… Ø¥Ø¶Ø§ÙØªÙƒ Ø¥Ù„Ù‰ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ ÙˆØ³ÙŠØµÙ„Ùƒ Ø¥Ø´Ø¹Ø§Ø± Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ù„Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª.</p>
          </div>
        </div>


        <div class="card p-3 admin-panel fade-in">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center">
              <h6 style="color:var(--primary-dark)">Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù†</h6>
              <div>
                <button id="toggleNeon" class="btn btn-sm btn-outline-success" title="Hacker Neon Mode"><i class="bi bi-lightning-charge"></i> Ù†ÙŠÙ€ÙˆÙ†</button>
              </div>
            </div>

            <form id="adminLogin" class="row g-2 mb-2" aria-label="ØªØ³Ø¬ÙŠÙ„ Ø£Ø¯Ù…Ù†">
              <div class="col-6"><input id="adminName" class="form-control" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" required></div>
              <div class="col-6"><input id="adminPass" class="form-control" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" type="password" required></div>
              <div class="col-12"><button class="btn btn-outline-primary w-100" type="submit"><i class="bi bi-lock"></i> Ø¯Ø®ÙˆÙ„</button></div>
            </form>

            <div id="adminPanel" class="d-none">
              <div class="mb-2">
                <h6 class="mb-1">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</h6>
                <canvas id="statsChart" height="120"></canvas>
              </div>

              <hr>
              <div class="mb-2">
                <h6 class="mb-1">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª</h6>
                <div class="mb-2">
                  <label class="form-label">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø­Ø¯Ø«</label>
                  <input id="ev_title" class="form-control form-control-sm" placeholder="Ù…Ø«Ù„Ø§Ù‹: Ù…Ø¤ØªÙ…Ø± Ø§Ù„Ø´Ø¨ÙŠØ¨Ø©">
                  <label class="form-label mt-2">Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª</label>
                  <input id="ev_datetime" class="form-control form-control-sm" type="datetime-local">
                  <label class="form-label mt-2">Ø³Ø¹Ø© Ø§Ù„Ù…Ù‚Ø§Ø¹Ø¯</label>
                  <input id="ev_capacity" class="form-control form-control-sm" type="number" min="1" value="50">
                  <label class="form-label mt-2">Ø³Ø¹Ø± Ø§Ù„ØªØ°ÙƒØ±Ø© (Ø¬Ù†ÙŠÙ‡)</label>
                  <input id="ev_price" class="form-control form-control-sm" type="number" min="0" value="0">
                  <label class="form-label mt-2">Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ø§Ù„ØºÙ„Ø§Ù (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                  <input id="ev_image" class="form-control form-control-sm" placeholder="Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø©">
                  <label class="form-label mt-2">ÙˆØµÙ Ù‚ØµÙŠØ±</label>
                  <textarea id="ev_desc" class="form-control form-control-sm" rows="2"></textarea>
                  <div class="d-flex gap-2 mt-2">
                    <button id="addEventBtn" class="btn btn-sm btn-success"><i class="bi bi-plus-circle"></i> Ø¥Ø¶Ø§ÙØ© Ø­Ø¯Ø«</button>
                    <button id="clearEventsBtn" class="btn btn-sm btn-danger"><i class="bi bi-trash"></i> Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«</button>
                  </div>
                </div>
              </div>

              <hr class="gold-hr">

              <div class="mb-2">
                <h6 class="mb-1">Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª</h6>
                <div class="d-flex gap-1 mb-2">
                  <select id="exportEventSelect" class="form-select form-select-sm"></select>
                  <button id="exportCsvBtn" class="btn btn-sm btn-success"><i class="bi bi-download"></i> ØªØµØ¯ÙŠØ± CSV</button>
                </div>
                <div class="d-flex gap-1">
                  <button id="clearBookingsBtn" class="btn btn-sm btn-danger">Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª</button>
                  <button id="logoutBtn" class="btn btn-sm btn-secondary ms-1">Ø®Ø±ÙˆØ¬</button>
                </div>
              </div>

              <div id="adminLists" style="max-height:240px; overflow:auto;"></div>
            </div>
          </div>
        </div>

      </aside>
    </div>
  </main>

  <!-- Removed WhatsApp floating button as requested -->

  <footer>
    <div class="container">
      <p class="mb-0 text-center">Ù…Ù†ØµØ© Ø­Ø¬Ø² Ø§Ù„Ù…Ø¤ØªÙ…Ø±Ø§Øª â€” Ø¥Ø¯Ø§Ø±Ø© ÙˆØ­Ø¬Ø² Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª</p>
      <p class="muted-small mt-1 made-center"><a id="madeBy" class="hacker-font" href="https://wa.me/201225346232?text=%D9%85%D8%B1%D8%AD%D8%A8%D8%A9%20%D8%8C%20%D9%84%D8%AF%D9%8A%20%D8%A7%D8%B3%D8%AA%D9%81%D8%B3%D8%A7%D8%B1%20%D8%B9%D9%86%20%D8%A7%D9%84%D9%85%D9%88%D9%82%D8%B9" target="_blank" rel="noopener" aria-label="ØªÙˆØ§ØµÙ„ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨ 01225346232">Made by: Gerges Adel</a></p>
    </div>
  </footer>

  <!-- Modals -->
  <div class="modal fade" id="authModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-sm modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header"><h6 class="modal-title">Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</h6><button data-bs-dismiss="modal" class="btn-close" aria-label="Ø¥ØºÙ„Ø§Ù‚"></button></div>
        <div class="modal-body">
          <div id="authTabs">
            <ul class="nav nav-tabs mb-2" role="tablist"><li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#tabLogin">Ø¯Ø®ÙˆÙ„</button></li></ul>
            <div class="tab-content">
              <div class="tab-pane fade show active" id="tabLogin" role="tabpanel">
                <form id="loginForm">
                  <div class="mb-2"><input id="login_email" class="form-control" placeholder="Ø§Ù„Ù‡Ø§ØªÙ Ø£Ùˆ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„" required aria-label="Ù‡Ø§ØªÙ Ø£Ùˆ Ø¥ÙŠÙ…ÙŠÙ„"></div>
                  <div class="mb-2"><input id="login_pass" class="form-control" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" required aria-label="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±"></div>
                  <div class="d-grid"><button class="btn btn-primary" type="submit">Ø¯Ø®ÙˆÙ„</button></div>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- profile modal (added) -->
  <div class="modal fade" id="profileModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-sm modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header"><h6 class="modal-title">Ø­Ø³Ø§Ø¨ÙŠ</h6><button data-bs-dismiss="modal" class="btn-close" aria-label="Ø¥ØºÙ„Ø§Ù‚"></button></div>
        <div class="modal-body" id="profileBody">
          <!-- content populated dynamically -->
        </div>
      </div>
    </div>
  </div>

  <!-- ticket modal -->
  <div class="modal fade" id="ticketModal" tabindex="-1" aria-hidden="true"><div class="modal-dialog modal-sm modal-dialog-centered"><div class="modal-content"><div class="modal-header"><h6 class="modal-title">ØªØ°ÙƒØ±ØªÙƒ</h6><button data-bs-dismiss="modal" class="btn-close" aria-label="Ø¥ØºÙ„Ø§Ù‚"></button></div><div class="modal-body"><div id="ticketCard" class="p-2 card" role="document"></div><div class="mt-2 d-flex gap-2"><button id="downloadTicketBtn" class="btn btn-primary w-100">ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ°ÙƒØ±Ø© (PDF)</button></div></div></div></div></div>

  <!-- lightbox modal (added) -->
  <div class="modal fade" id="lightboxModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content">
        <div class="modal-body p-0">
          <img id="lightboxImg" src="" alt="ØµÙˆØ±Ø©" style="width:100%;height:auto;display:block;border-radius:6px;">
        </div>
        <div class="modal-footer"><button data-bs-dismiss="modal" class="btn btn-sm btn-secondary">Ø¥ØºÙ„Ø§Ù‚</button></div>
      </div>
    </div>
  </div>

  <!-- chat box -->
  <div class="card chat-box d-none" id="chatBox" style="position:fixed;bottom:100px;right:22px;width:320px;z-index:1060;">
    <div class="card-body p-2">
      <div class="d-flex justify-content-between align-items-center"><strong>Ø¯Ø¹Ù… Ù…Ø¨Ø§Ø´Ø±</strong><button id="closeChat" class="btn btn-sm btn-outline-secondary" aria-label="Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©">âœ–</button></div>
      <div class="chat-messages my-2" id="chatMessages" style="max-height:220px;overflow:auto;"></div>
      <form id="chatForm" class="d-flex gap-1" aria-label="Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©">
        <input id="chatInput" class="form-control form-control-sm" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©..." aria-label="Ø±Ø³Ø§Ù„Ø©">
        <button class="btn btn-sm btn-primary" type="submit">Ø¥Ø±Ø³Ø§Ù„</button>
      </form>
    </div>
  </div>

  <!-- libs -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" defer></script>

  <!-- Firebase (compat) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <script>
  /* ------------------------------------------------------------------
     Firestore-backed client script (compat) â€” replaces IndexedDB with Firestore
     - Collections: events, bookings, users
     - Admin credentials (local): admin. / admin1289
     - Seed sample events if none exist
  ------------------------------------------------------------------ */

  // ********** Firebase config (from your earlier message) **********
  const firebaseConfig = {
    apiKey: "AIzaSyA6DzlGR8ViD_EeplPYfiCP4gXN6qDvsVE",
    authDomain: "new-project-dfacc.firebaseapp.com",
    databaseURL: "https://new-project-dfacc-default-rtdb.firebaseio.com",
    projectId: "new-project-dfacc",
    storageBucket: "new-project-dfacc.firebasestorage.app",
    messagingSenderId: "194379100416",
    appId: "1:194379100416:web:9105130b1ecd6c8ad403e5",
    measurementId: "G-7G547B1X2L"
  };
  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  // Utility helpers
  function escapeHtml(s){ return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
  function formatDate(d){ try{ const dt=new Date(d); return dt.toLocaleString('ar-EG',{year:'numeric',month:'short',day:'numeric',hour:'2-digit',minute:'2-digit'}); }catch(e){return d;} }

  // session
  let currentUser = null;
  function setSession(u){ currentUser=u; localStorage.setItem('gse_user', JSON.stringify(u)); updateAuthUI(); }
  function clearSession(){ currentUser=null; localStorage.removeItem('gse_user'); updateAuthUI(); }
  function loadSession(){ const s=localStorage.getItem('gse_user'); if(s) currentUser=JSON.parse(s); updateAuthUI(); }

  // ********** Firestore operations **********
  async function fetchEvents(){
    const snap = await db.collection('events').orderBy('datetime','asc').get();
    return snap.docs.map(d => ({ id:d.id, ...d.data() }));
  }
  async function fetchBookings(){
    const snap = await db.collection('bookings').orderBy('createdAt','desc').get();
    return snap.docs.map(d => ({ id:d.id, ...d.data() }));
  }
  async function addEventToDb(ev){ const ref = await db.collection('events').add(ev); return ref.id; }
  async function updateEventInDb(id, patch){ await db.collection('events').doc(id).update(patch); }
  async function deleteEventFromDb(id){
    // delete bookings related
    const bq = await db.collection('bookings').where('eventId','==',id).get();
    const batch = db.batch();
    bq.forEach(doc=> batch.delete(doc.ref));
    batch.delete(db.collection('events').doc(id));
    await batch.commit();
  }
  async function addBookingToDb(bk){
    const ref = await db.collection('bookings').add(bk);
    return ref.id;
  }
  async function deleteAllEvents(){
    const evs = await db.collection('events').get();
    const batch = db.batch();
    evs.forEach(doc => batch.delete(doc.ref));
    const bks = await db.collection('bookings').get();
    bks.forEach(doc => batch.delete(doc.ref));
    await batch.commit();
  }
  async function clearAllBookings(){
    const bks = await db.collection('bookings').get();
    const batch = db.batch();
    bks.forEach(doc => batch.delete(doc.ref));
    await batch.commit();
  }

  // seed sample events if empty
  async function seedIfEmpty(){
    const evsSnap = await db.collection('events').limit(1).get();
    if(evsSnap.empty){
      const now = Date.now();
      const sample = [
        { title:'Ù…Ø¤ØªÙ…Ø± Ø§Ù„Ø´Ø¨ÙŠØ¨Ø© Ø§Ù„Ù…Ø³ÙŠØ­ÙŠ', datetime:new Date(now + 8*24*3600*1000).toISOString(), capacity:200, price:150, image:'https://images.unsplash.com/photo-1508669232496-4be7b04a8c8a?w=900&q=80&auto=format&fit=crop', desc:'Ù…Ø¤ØªÙ…Ø± Ù„Ù„Ø´Ø¨Ø§Ø¨ Ù…Ø¹ Ø®Ø·Ø¨ ÙˆÙˆØ±Ø´.' },
        { title:'ÙˆØ±Ø´Ø© Ø§Ù„Ø®Ø¯Ù…Ø© Ø§Ù„Ù…Ø¬ØªÙ…Ø¹ÙŠØ©', datetime:new Date(now + 20*24*3600*1000).toISOString(), capacity:80, price:50, image:'https://images.unsplash.com/photo-1521737604893-d14cc237f11d?w=900&q=80&auto=format&fit=crop', desc:'ÙˆØ±Ø´Ø© Ø¹Ù…Ù„ Ù„Ù„Ø®Ø¯Ù…Ø© ÙˆØ§Ù„Ù…Ø´Ø§Ø±ÙƒØ©.' },
        { title:'Ù…Ø¤ØªÙ…Ø± Ø§Ù„Ø£Ø³Ø±Ø©', datetime:new Date(now + 40*24*3600*1000).toISOString(), capacity:150, price:100, image:'https://images.unsplash.com/photo-1524504388940-b1c1722653e1?w=900&q=80&auto=format&fit=crop', desc:'Ù…Ø¤ØªÙ…Ø± Ù„Ø¯Ø¹Ù… Ø§Ù„Ø­ÙŠØ§Ø© Ø§Ù„Ø£Ø³Ø±ÙŠØ©.' }
      ];
      for(const s of sample) await addEventToDb(s);
    }
    // ensure admin user exists in users collection (optional)
    const us = await db.collection('users').where('username','==','admin.').limit(1).get();
    if(us.empty){
      await db.collection('users').add({ username:'admin.', name:'Admin', pass:'admin1289', role:'admin', createdAt:new Date().toISOString() });
    }
  }

  /* ---------- Renderers & UI glue (Firestore-based) ---------- */
  async function renderEvents(filterText='', sort='date'){
    const grid=document.getElementById('eventsGrid'); grid.innerHTML='';
    let evs = await fetchEvents();
    if(!evs || evs.length===0){
      grid.innerHTML='<div class="col-12"><p class="muted-small">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙØ¹Ø§Ù„ÙŠØ§Øª Ø­Ø§Ù„ÙŠÙ‹Ø§.</p></div>';
      populateSelects();
      renderGallery();
      renderCalendar();
      renderAdminLists();
      return;
    }
    if(filterText) evs = evs.filter(e=> (e.title||'').toLowerCase().includes(filterText.toLowerCase()));
    const bookings = await fetchBookings();
    evs = evs.map(ev=>{
      const booked = bookings.filter(b=>b.eventId==ev.id).reduce((s,b)=>s+Number(b.seats||0),0);
      ev.remaining = Math.max(0,(ev.capacity||0)-booked);
      return ev;
    });
    if(sort==='date') evs.sort((a,b)=>new Date(a.datetime)-new Date(b.datetime));
    else if(sort==='remaining') evs.sort((a,b)=>b.remaining-a.remaining);
    else if(sort==='price_desc') evs.sort((a,b)=>(b.price||0)-(a.price||0));

    for(const ev of evs){
      const col=document.createElement('div'); col.className='col-12 col-md-6';
      const card=document.createElement('div'); card.className='card p-0 fade-up';
      const img=document.createElement('img'); img.className='event-thumb'; img.loading='lazy'; img.alt=ev.title||'Event image'; img.src=ev.image||'';
      const body=document.createElement('div'); body.className='p-3';
      body.innerHTML=`<h5 class="mb-1">${escapeHtml(ev.title)}</h5><div class="muted-small mb-1">${formatDate(ev.datetime)}</div><div class="mb-2">${escapeHtml(ev.desc||'')}</div><div class="d-flex justify-content-between align-items-center"><div><span class="badge-cap">Ø¨Ø§Ù‚ÙŠ ${ev.remaining} / ${ev.capacity} Ù…Ù‚Ø¹Ø¯</span></div><div class="text-end"><strong>${ev.price||0} Ø¬</strong></div></div><div class="mt-2 d-flex gap-2"><button class="btn btn-sm btn-primary book-btn" data-id="${ev.id}"><i class="bi bi-ticket"></i> Ø§Ø­Ø¬Ø²</button><button class="btn btn-sm btn-outline-secondary view-attendees" data-id="${ev.id}"><i class="bi bi-people"></i> Ø§Ù„Ø­Ø¶ÙˆØ±</button></div>`;
      card.appendChild(img); card.appendChild(body); col.appendChild(card); grid.appendChild(col);
      body.querySelector('.book-btn').addEventListener('click', function(){ document.getElementById('selectEvent').value=this.getAttribute('data-id'); document.getElementById('bk_name').focus(); window.scrollTo({top:0,behavior:'smooth'}); });
      body.querySelector('.view-attendees').addEventListener('click', async function(){
        const id=this.getAttribute('data-id');
        const list = (await fetchBookings()).filter(b=>String(b.eventId)===String(id));
        const evTitle = ev.title||'';
        let txt=`Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø­Ø¶ÙˆØ± Ù„Ø­Ø¯Ø«: ${evTitle}\n\n`;
        if(!list||list.length===0) txt+='Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø¬ÙˆØ²Ø§Øª'; else list.forEach(b=> txt+=`${b.name} â€” ${b.phone} â€” Ù…Ù‚Ø§Ø¹Ø¯: ${b.seats}\n`);
        alert(txt);
      });
    }

    populateSelects(); renderCountdown(); renderCalendar(); renderGallery(); renderAdminLists();
  }

  async function populateSelects(){
    const sel=document.getElementById('selectEvent'); sel.innerHTML='';
    const exportSel=document.getElementById('exportEventSelect'); exportSel.innerHTML='';
    const evs = await fetchEvents();
    if(!evs||evs.length===0){ sel.innerHTML='<option value="">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙØ¹Ø§Ù„ÙŠØ§Øª</option>'; return; }
    evs.sort((a,b)=>new Date(a.datetime)-new Date(b.datetime));
    for(const ev of evs){
      const opt=document.createElement('option'); opt.value=ev.id; opt.textContent=`${ev.title} â€” ${formatDate(ev.datetime)}`; sel.appendChild(opt);
      const opt2 = opt.cloneNode(true); exportSel.appendChild(opt2);
    }
  }

  // booking form
  document.getElementById('bookingForm').addEventListener('submit', async function(e){
    e.preventDefault();
    const name=document.getElementById('bk_name').value.trim(); const phone=document.getElementById('bk_phone').value.trim();
    if(!name || !phone){ alert('Ø§ÙƒØªØ¨ Ø§Ù„Ø§Ø³Ù… ÙˆØ±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ'); return; }
    if(!/^[0-9\+\s\-]{6,20}$/.test(phone)){ alert('Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ØºÙŠØ± ØµØ§Ù„Ø­'); return; }
    const evId = document.getElementById('selectEvent').value;
    if(!evId){ alert('Ø§Ø®ØªØ± Ø­Ø¯Ø«Ù‹Ø§'); return; }
    const rec = { eventId: evId, name, phone, seats:1, amount:0, payMethod:'none', paid:false, createdAt:new Date().toISOString() };
    const id = await addBookingToDb(rec);
    rec.id = id;
    // show ticket
    const evs = await fetchEvents(); const ev = evs.find(x=>String(x.id)===String(evId)) || {};
    showTicket(ev, rec);
    this.reset();
    renderEvents(document.getElementById('searchInput').value, document.getElementById('sortSelect').value);
  });

  // admin login
  document.getElementById('adminLogin').addEventListener('submit', async function(e){
    e.preventDefault();
    const name = document.getElementById('adminName').value.trim();
    const pass = document.getElementById('adminPass').value;
    if(name==='admin.' && pass==='admin1289'){
      const adminUser = { id:'admin.', username:'admin.', name:'Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…', role:'admin' };
      setSession(adminUser);
      const ap=document.getElementById('adminPanel'); ap.classList.remove('d-none'); ap.classList.add('show');
      await renderAdminLists(); populateSelects();
      alert('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙƒØ£Ø¯Ù…Ù†');
      return;
    }
    // fallback: check users collection
    const usSnap = await db.collection('users').where('username','==',name).where('pass','==',pass).limit(1).get();
    if(!usSnap.empty){
      const doc = usSnap.docs[0];
      const found = { id: doc.id, ...doc.data() };
      if(found.role==='admin'){
        setSession({ id:found.id, username:found.username||found.id, name:found.name||found.username, role:'admin' });
        const ap=document.getElementById('adminPanel'); ap.classList.remove('d-none'); ap.classList.add('show');
        await renderAdminLists(); populateSelects();
        alert('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙƒØ£Ø¯Ù…Ù†');
        return;
      }
    }
    alert('Ø¨ÙŠØ§Ù†Ø§Øª Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø£Ø¯Ù…Ù† ØºÙŠØ± ØµØ­ÙŠØ­Ø©');
  });

  // admin actions
  document.getElementById('addEventBtn').addEventListener('click', async function(e){
    e.preventDefault();
    if(!currentUser || currentUser.role!=='admin'){ alert('ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø£Ø¯Ù…Ù† Ù…Ø·Ù„ÙˆØ¨Ø©'); return; }
    const title=document.getElementById('ev_title').value.trim(); const datetime=document.getElementById('ev_datetime').value;
    const capacity=Math.max(1, Number(document.getElementById('ev_capacity').value)||10); const price=Number(document.getElementById('ev_price').value)||0; const image=document.getElementById('ev_image').value.trim(); const desc=document.getElementById('ev_desc').value.trim();
    if(!title||!datetime){ alert('Ø§ÙƒØªØ¨ Ø¹Ù†ÙˆØ§Ù† ÙˆØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø¯Ø«'); return; }
    const ev={ title, datetime:new Date(datetime).toISOString(), capacity, price, image, desc, createdAt:new Date().toISOString() };
    await addEventToDb(ev); alert('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø­Ø¯Ø« (ÙÙŠ Ø§Ù„Ø³Ø­Ø§Ø¨Ø©)'); document.getElementById('ev_title').value=''; document.getElementById('ev_datetime').value=''; document.getElementById('ev_desc').value=''; document.getElementById('ev_image').value='';
    renderEvents();
  });

  document.getElementById('clearEventsBtn').addEventListener('click', async function(){
    if(!currentUser || currentUser.role!=='admin'){ alert('ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø£Ø¯Ù…Ù† Ù…Ø·Ù„ÙˆØ¨Ø©'); return; }
    if(!confirm('Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«ØŸ')) return;
    await deleteAllEvents();
    renderEvents();
    alert('ØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«');
  });

  document.getElementById('exportCsvBtn').addEventListener('click', async function(){
    const evId=document.getElementById('exportEventSelect').value; if(!evId){ alert('Ø§Ø®ØªØ± Ø­Ø¯Ø«Ù‹Ø§ Ù„Ù„ØªØµØ¯ÙŠØ±'); return; }
    const snap = await db.collection('bookings').where('eventId','==',evId).get();
    const arr = snap.docs.map(d=> ({ id:d.id, ...d.data() }) );
    if(!arr||arr.length===0){ alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø¬ÙˆØ²Ø§Øª Ù„Ù‡Ø°Ø§ Ø§Ù„Ø­Ø¯Ø«'); return; }
    const header=['id','eventId','name','phone','email','seats','amount','payMethod','paid','createdAt'];
    const rows = arr.map(r=> header.map(h=>`"${String(r[h]||'').replace(/"/g,'""')}"`).join(','));
    const csv = [header.join(','), ...rows].join('\r\n');
    const blob = new Blob(["\uFEFF"+csv],{ type:'text/csv;charset=utf-8;' }); const url = URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='bookings_event_'+evId+'.csv'; a.click(); URL.revokeObjectURL(url);
  });

  document.getElementById('clearBookingsBtn').addEventListener('click', async function(){
    if(!currentUser || currentUser.role!=='admin'){ alert('ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø£Ø¯Ù…Ù† Ù…Ø·Ù„ÙˆØ¨Ø©'); return; }
    if(!confirm('Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§ØªØŸ')) return;
    await clearAllBookings();
    renderAdminLists(); renderEvents();
    alert('ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª');
  });

  document.getElementById('logoutBtn').addEventListener('click', function(){
    const ap=document.getElementById('adminPanel'); ap.classList.remove('show'); setTimeout(()=> ap.classList.add('d-none'), 300); clearSession(); alert('ØªÙ… Ø§Ù„Ø®Ø±ÙˆØ¬');
  });

  async function renderAdminLists(){
    const container=document.getElementById('adminLists'); container.innerHTML='';
    const evs = await fetchEvents();
    const bookings = await fetchBookings();
    const evFrag=document.createElement('div'); evFrag.innerHTML='<strong>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª</strong><div class="mt-2"></div>';
    if(!evs||evs.length===0) evFrag.innerHTML+='<div class="muted-small">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙØ¹Ø§Ù„ÙŠØ§Øª</div>';
    else{
      evs.slice().reverse().forEach(ev=>{
        const booked=(bookings.filter(b=>String(b.eventId)===String(ev.id)).reduce((s,b)=>s+Number(b.seats),0));
        const remaining=Math.max(0,(ev.capacity||0)-booked);
        const d=document.createElement('div'); d.className='p-2 mb-2 border rounded';
        d.innerHTML=`<div class="d-flex justify-content-between align-items-center"><div><strong>${escapeHtml(ev.title)}</strong><div class="muted-small">${formatDate(ev.datetime)} â€” ${ev.capacity} Ù…Ù‚Ø¹Ø¯ â€” Ù…ØªØ¨Ù‚ÙŠ ${remaining}</div></div><div><button class="btn btn-sm btn-outline-danger del-ev" data-id="${ev.id}">Ø­Ø°Ù</button></div></div>`;
        evFrag.querySelector('div').appendChild(d);
        d.querySelector('.del-ev').addEventListener('click', async function(){ if(!confirm('Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø­Ø¯Ø« (Ø³ÙŠØ­Ø°Ù Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø©)ØŸ')) return; const id=this.getAttribute('data-id'); await deleteEventFromDb(id); renderAdminLists(); renderEvents(); populateSelects(); });
      });
    }
    container.appendChild(evFrag);

    const bFrag=document.createElement('div'); bFrag.className='mt-3'; bFrag.innerHTML='<strong>Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ø£Ø®ÙŠØ±Ø©</strong><div class="mt-2"></div>';
    if(!bookings||bookings.length===0) bFrag.innerHTML+='<div class="muted-small">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø¬ÙˆØ²Ø§Øª</div>';
    else{
      bookings.slice().reverse().slice(0,30).forEach(b=>{
        const dd=document.createElement('div'); dd.className='p-2 mb-2 border rounded';
        const ev=evs.find(x=>String(x.id)===String(b.eventId));
        dd.innerHTML=`<div><strong>${escapeHtml(b.name)}</strong> â€” ${escapeHtml(b.phone)}<div class="muted-small">${escapeHtml(ev?ev.title:'-')} â€¢ ${escapeHtml(b.seats+' Ù…Ù‚Ø¹Ø¯')} â€¢ ${escapeHtml(b.createdAt)}</div></div>`;
        bFrag.querySelector('div').appendChild(dd);
      });
    }
    container.appendChild(bFrag);

    // stats chart
    try{
      const ctx=document.getElementById('statsChart').getContext('2d');
      if(window.statsChart) window.statsChart.destroy();
      const labels = evs.map(e=>e.title);
      const data = evs.map(e=> bookings.filter(b=>String(b.eventId)===String(e.id)).reduce((s,b)=>s+Number(b.seats||0),0));
      window.statsChart = new Chart(ctx, { type:'bar', data:{ labels, datasets:[{ label:'Ø­Ø¬ÙˆØ²Ø§Øª', data, tension:0.3 }] }, options:{ responsive:true, plugins:{ legend:{display:false}}, scales:{ x:{ ticks:{ maxRotation:30 } } } } });
    }catch(e){ console.warn(e); }
  }

  // countdown & helpers
  let countdownTimer=null;
  async function renderCountdown(){ const el=document.getElementById('nextEventCountdown'); const txt=document.getElementById('countdownText'); const pr=document.getElementById('countdownProgress'); const evs = await fetchEvents(); if(!evs||evs.length===0){ el.style.display='none'; return; } el.style.display='flex'; const upcoming=evs.sort((a,b)=>new Date(a.datetime)-new Date(b.datetime))[0]; function update(){ const diff=new Date(upcoming.datetime)-new Date(); if(diff<=0){ txt.textContent=`ğŸ‰ Ø§Ù„Ù…Ø¤ØªÙ…Ø± "${upcoming.title}" Ø¨Ø¯Ø£ Ø§Ù„Ø¢Ù†!`; pr.style.width='100%'; clearInterval(countdownTimer); return; } const days=Math.floor(diff/(1000*60*60*24)); const hours=Math.floor((diff%(1000*60*60*24))/(1000*60*60)); const mins=Math.floor((diff%(1000*60*60))/(1000*60)); txt.textContent=`â³ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ø­ØªÙ‰ "${upcoming.title}": ${days} ÙŠÙˆÙ… Ùˆ${hours} Ø³Ø§Ø¹Ø© Ùˆ${mins} Ø¯Ù‚ÙŠÙ‚Ø©`; const total= Math.max(1, (new Date(upcoming.datetime)-Date.now())); const pct=Math.max(0, Math.min(100, 100 - Math.floor((total) / (1000*60*60*24*30) *100))); pr.style.width=pct+'%'; }
    update(); if(countdownTimer) clearInterval(countdownTimer); countdownTimer=setInterval(update,60000);
  }

  // calendar
  let calDate=new Date();
  async function renderCalendar(){ const grid=document.getElementById('calendarGrid'); grid.innerHTML=''; const events=await fetchEvents(); const year=calDate.getFullYear(), month=calDate.getMonth(); const first=new Date(year,month,1); const startDay=(first.getDay()+6)%7; const daysInMonth=new Date(year,month+1,0).getDate(); document.getElementById('calTitle').textContent=first.toLocaleString('ar-EG',{ month:'long', year:'numeric' }); const totalCells=42; let dayNum=1-startDay; for(let i=0;i<totalCells;i++, dayNum++){ const d=new Date(year,month,dayNum); const col=document.createElement('div'); col.className='col-2'; const box=document.createElement('div'); box.className='cal-day'; if(d.getMonth()!==month) box.style.opacity='0.35'; const header=document.createElement('div'); header.innerHTML=`<strong style="font-size:13px">${d.getDate()}</strong>`; box.appendChild(header); const dayEvents=events.filter(ev=> new Date(ev.datetime).toDateString()===d.toDateString()); for(const ev of dayEvents){ const evEl=document.createElement('div'); evEl.className='tag mt-1'; evEl.style.cursor='pointer'; evEl.textContent=ev.title; evEl.addEventListener('click', ()=>{ document.getElementById('selectEvent').value=ev.id; window.scrollTo({top:0,behavior:'smooth'}); }); box.appendChild(evEl); } col.appendChild(box); grid.appendChild(col); }
  }
  document.getElementById('calPrev').addEventListener('click', ()=>{ calDate.setMonth(calDate.getMonth()-1); renderCalendar(); });
  document.getElementById('calNext').addEventListener('click', ()=>{ calDate.setMonth(calDate.getMonth()+1); renderCalendar(); });

  // gallery
  async function renderGallery(){ const grid=document.getElementById('galleryGrid'); grid.innerHTML=''; const evs=await fetchEvents(); const imgs=evs.filter(e=>e.image).map(e=>({src:e.image,title:e.title})).slice(0,8); if(imgs.length===0){ grid.innerHTML='<div class="muted-small">Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙˆØ± Ø­Ø§Ù„ÙŠØ§Ù‹</div>'; return; } imgs.forEach((im,idx)=>{ const col=document.createElement('div'); col.className='col-6 col-md-3'; const img=document.createElement('img'); img.src=im.src; img.alt=im.title; img.className='w-100'; img.style.height='110px'; img.style.objectFit='cover'; img.loading='lazy'; img.addEventListener('click', ()=>{ document.getElementById('lightboxImg').src=im.src; new bootstrap.Modal(document.getElementById('lightboxModal')).show(); }); col.appendChild(img); grid.appendChild(col); }); }

  // ticket generation
  async function showTicket(ev, rec){ const ticketCard=document.getElementById('ticketCard'); ticketCard.innerHTML=`<div><strong>${escapeHtml(ev.title)}</strong></div><div class="muted-small">${formatDate(ev.datetime)}</div><div class="mt-2"><strong>${escapeHtml(rec.name)}</strong> â€” ${escapeHtml(rec.phone)}</div><div class="muted-small">Ù…Ù‚Ø§Ø¹Ø¯: ${rec.seats} â€” Ø§Ù„Ù…Ø¨Ù„Øº: ${rec.amount} Ø¬</div><div class="muted-small mt-2">Ø±Ù‚Ù… Ø§Ù„ØªØ°ÙƒØ±Ø©: ${rec.id}</div>`; const ticketModal=new bootstrap.Modal(document.getElementById('ticketModal')); ticketModal.show(); document.getElementById('downloadTicketBtn').onclick=()=> { const { jsPDF } = window.jspdf; const doc=new jsPDF({ unit:'pt', format:'a4' }); doc.setFontSize(18); doc.text(`ØªØ°ÙƒØ±Ø© Ø­Ø¶ÙˆØ±`, 40, 60); doc.setFontSize(14); doc.text(`Ø§Ù„Ø­Ø¯Ø«: ${ev.title}`, 40, 100); doc.text(`Ø§Ù„ØªØ§Ø±ÙŠØ®: ${formatDate(ev.datetime)}`, 40, 124); doc.text(`Ø§Ù„Ø§Ø³Ù…: ${rec.name}`, 40, 148); doc.text(`Ø§Ù„Ù‡Ø§ØªÙ: ${rec.phone}`, 40, 172); doc.text(`Ù…Ù‚Ø§Ø¹Ø¯: ${rec.seats}`, 40, 196); doc.text(`Ø±Ù‚Ù… Ø§Ù„ØªØ°ÙƒØ±Ø©: ${rec.id}`, 40, 220); doc.save('ticket_'+rec.id+'.pdf'); };
  }

  // notifications
  function notifyUser(title, body){ if(!('Notification' in window)) return; if(Notification.permission==='granted') new Notification(title,{ body }); else if(Notification.permission!=='denied'){ Notification.requestPermission().then(permission=>{ if(permission==='granted') new Notification(title,{ body }); }); } }

  // auth forms (login for users)
  document.getElementById('loginForm').addEventListener('submit', async function(e){ e.preventDefault(); const cred=document.getElementById('login_email').value.trim(); const pass=document.getElementById('login_pass').value; // try users collection
    let foundUser = null;
    try{
      const usSnap = await db.collection('users').where('phone','==',cred).limit(1).get();
      if(!usSnap.empty) foundUser = { id: usSnap.docs[0].id, ...usSnap.docs[0].data() };
      else {
        const usSnap2 = await db.collection('users').where('email','==',cred).limit(1).get();
        if(!usSnap2.empty) foundUser = { id: usSnap2.docs[0].id, ...usSnap2.docs[0].data() };
      }
      if(foundUser && foundUser.pass===pass){ setSession({ id:foundUser.id, name:foundUser.name||foundUser.username, phone:foundUser.phone, email:foundUser.email, role:foundUser.role }); new bootstrap.Modal(document.getElementById('authModal')).hide(); notifyUser('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„', `Ù…Ø±Ø­Ø¨Ù‹Ø§ ${foundUser.name||foundUser.username}`); renderEvents(); return; }
    }catch(e){}
    alert('Ø¨ÙŠØ§Ù†Ø§Øª Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©');
  });

  function updateAuthUI(){ const btn=document.getElementById('btnLogin'); const label=document.getElementById('loginLabel'); if(currentUser){ btn.innerHTML=`<i class="bi bi-person"></i> ${escapeHtml(currentUser.name||currentUser.username)}`; btn.onclick=()=>{ document.getElementById('profileBody').innerHTML=`<div><strong>${escapeHtml(currentUser.name||currentUser.username)}</strong></div><div class="muted-small">${escapeHtml(currentUser.phone||'')}</div><div class="mt-2"><button id="editProfile" class="btn btn-sm btn-outline-secondary">ØªØ¹Ø¯ÙŠÙ„</button> <button id="logoutUser" class="btn btn-sm btn-danger">Ø®Ø±ÙˆØ¬</button></div>`; new bootstrap.Modal(document.getElementById('profileModal')).show(); document.getElementById('logoutUser').addEventListener('click', ()=>{ clearSession(); new bootstrap.Modal(document.getElementById('profileModal')).hide(); }); document.getElementById('editProfile').addEventListener('click', async ()=>{ const n=prompt('Ø§Ù„Ø§Ø³Ù…', currentUser.name||currentUser.username); if(n){ try{ const uDoc = db.collection('users').doc(currentUser.id); await uDoc.update({ name: n }); currentUser.name = n; setSession(currentUser); alert('ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«'); new bootstrap.Modal(document.getElementById('profileModal')).hide(); }catch(e){ alert('ÙØ´Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ«'); } } }); }; } else { btn.innerHTML=`<i class="bi bi-person"></i> <span id="loginLabel">Ø¯Ø®ÙˆÙ„</span>`; btn.onclick=()=>{ new bootstrap.Modal(document.getElementById('authModal')).show(); }; } }

  // chat support (local)
  document.getElementById('closeChat').addEventListener('click', ()=> document.getElementById('chatBox').classList.add('d-none'));
  document.getElementById('chatForm').addEventListener('submit', async function(e){ e.preventDefault(); const txt=document.getElementById('chatInput').value.trim(); if(!txt) return; alert('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© (Ù…Ø­Ù„ÙŠÙ‹Ø§)'); document.getElementById('chatInput').value=''; });

  // theme button
  const themeBtn=document.getElementById('darkToggle'); function applyTheme(t){ if(t==='dark') document.documentElement.setAttribute('data-theme','dark'); else document.documentElement.removeAttribute('data-theme'); localStorage.setItem('gse_theme',t); themeBtn.innerHTML=t==='dark'?'<i class="bi bi-sun-fill"></i> ÙˆØ¶Ø¹ Ù†Ù‡Ø§Ø±ÙŠ':'<i class="bi bi-moon-stars"></i> ÙˆØ¶Ø¹ Ù„ÙŠÙ„ÙŠ'; themeBtn.setAttribute('aria-pressed', t==='dark'); }
  themeBtn.addEventListener('click', ()=> applyTheme(localStorage.getItem('gse_theme')==='dark'?'light':'dark'));

  // Neon toggle
  document.getElementById('toggleNeon').addEventListener('click', function(){ document.body.classList.toggle('neon'); this.classList.toggle('active'); });

  // quick register (added)
  document.addEventListener('DOMContentLoaded', function(){
    async function quickRegisterHandler(e){
      e.preventDefault();
      const name = document.getElementById('qr_name').value.trim();
      const phone = document.getElementById('qr_phone').value.trim();
      if(!name || !phone){ alert('Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ù‡Ø§ØªÙ Ù…Ø·Ù„ÙˆØ¨Ø§Ù†'); return; }
      try{
        const id = 'u_'+Date.now();
        await db.collection('users').add({ id, name, phone, createdAt: new Date().toISOString(), role: 'user' });
        alert('ØªÙ… Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø¨Ù†Ø¬Ø§Ø­ â€” Ø³Ù†Ø®Ø·Ø±Ùƒ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØªØ³Ø¬ÙŠÙ„');
        document.getElementById('quickRegister').reset();
      }catch(err){
        fallback();
      }
      function fallback(){ const list = JSON.parse(localStorage.getItem('gse_members')||'[]'); list.push({ id: 'u_'+Date.now(), name, phone, createdAt: new Date().toISOString() }); localStorage.setItem('gse_members', JSON.stringify(list)); alert('ØªÙ… Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ (Ù…Ø­Ù„ÙŠÙ‹Ø§) â€” Ø³Ù†Ø®Ø·Ø±Ùƒ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØªØ³Ø¬ÙŠÙ„'); document.getElementById('quickRegister').reset(); }
    }
    const qrForm = document.getElementById('quickRegister');
    if(qrForm) qrForm.addEventListener('submit', quickRegisterHandler);

    const ticketModalEl = document.getElementById('ticketModal');
    if(ticketModalEl){
      ticketModalEl.addEventListener('shown.bs.modal', function(){ const focusable = ticketModalEl.querySelector('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'); if(focusable) focusable.focus(); });
    }
  });

  // init
  (async function init(){
    applyTheme(localStorage.getItem('gse_theme')||'light');
    await seedIfEmpty();
    loadSession();
    renderEvents();
    if(Notification && Notification.permission!=='granted' && Notification.permission!=='denied'){ try{ await Notification.requestPermission(); }catch(e){} }
    // listen to remote changes: realtime updates using onSnapshot for events and bookings
    db.collection('events').orderBy('datetime','asc').onSnapshot(()=> renderEvents(document.getElementById('searchInput').value, document.getElementById('sortSelect').value));
    db.collection('bookings').onSnapshot(()=> renderEvents(document.getElementById('searchInput').value, document.getElementById('sortSelect').value));
    document.addEventListener('keydown', (e)=>{ if((e.key==='/'&&e.metaKey) || (e.key==='/'&&e.ctrlKey)) document.getElementById('chatBox').classList.remove('d-none'); });
    if(!sessionStorage.getItem('gse_csrf')) sessionStorage.setItem('gse_csrf', Math.random().toString(36).slice(2));
  })();

  // search + sort listeners
  document.getElementById('searchInput').addEventListener('input', (e)=> renderEvents(e.target.value, document.getElementById('sortSelect').value));
  document.getElementById('sortSelect').addEventListener('change', (e)=> renderEvents(document.getElementById('searchInput').value, e.target.value));

  // ---------------------------
  // SERVICE VERSES (random)
  // ---------------------------
  (function setupServiceVerses(){
    const verses = [
      "ÙƒÙÙ„Ù‘Ù Ù…ÙØ§ ØªÙØ¬ÙØ¯ÙÙ‡Ù ÙŠÙØ¯ÙÙƒÙ Ù„ÙØªÙØ¹Ù’Ù…ÙÙ„ÙÙ‡Ù ÙÙØ§Ø¹Ù’Ù…ÙÙ„Ù’Ù‡Ù Ø¨ÙÙ‚ÙÙˆÙ‘ÙØªÙÙƒÙ",
      "Ù…ÙØºÙ’Ø¨ÙÙˆØ·ÙŒ Ù‡ÙÙˆÙ Ø§Ù„Ù’Ø¹ÙØ·ÙØ§Ø¡Ù Ø£ÙÙƒÙ’Ø«ÙØ±Ù Ù…ÙÙ†Ù Ø§Ù„Ù’Ø£ÙØ®Ù’Ø°Ù",
      "Ù„ÙØªÙØ¶ÙØ¦ Ø£ÙØ¹Ù’Ù…ÙØ§Ù„ÙÙƒÙÙ…Ù’ Ù‚ÙØ¯Ù‘ÙØ§Ù…Ù Ø§Ù„Ù†Ù‘ÙØ§Ø³Ù",
      "Ø§Ø«Ù’Ø¨ÙØªÙÙˆØ§ Ø±ÙØ§Ø³ÙØ®ÙÙŠÙ†Ù ØºÙÙŠÙ’Ø±Ù Ù…ÙØªÙØ²ÙØ¹Ù’Ø²ÙØ¹ÙÙŠÙ†Ù ÙÙÙŠ Ø§Ù„Ù’Ø®ÙØ¯Ù’Ù…ÙØ©Ù",
      "Ù…ÙØ§ ØªÙÙÙ’Ø¹ÙÙ„ÙÙˆÙ‡Ù ÙÙØ§Ø¹Ù’Ù…ÙÙ„ÙÙˆÙ‡Ù Ù…ÙÙ†Ù’ Ù‚ÙÙ„ÙÙˆØ¨ÙÙƒÙÙ…Ù’ ÙƒÙÙ„ÙÙ„Ù‘ÙÙ‡Ù",
      "Ø§Ù„Ø®Ø¯Ù…Ø© Ù†ÙˆØ±ÙŒ ÙŠØ¶ÙŠØ¡ Ø§Ù„Ù‚Ù„ÙˆØ¨ ÙˆÙŠØ¬Ù…Ø¹ Ø§Ù„Ù†Ø§Ø³ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø­Ø¨Ø©.",
      "Ø§Ø¹Ù…Ù„ Ø¨Ø®Ø¯Ù…Ø©Ù Ø¯ÙˆÙ† Ø§Ù†ØªØ¸Ø§Ø± Ù…Ù‚Ø§Ø¨Ù„ØŒ ÙØ§Ù„Ø¹Ø·Ø§Ø¡ ÙŠØ«Ù…Ø± Ø¨Ø±ÙƒØ©.",
      "ÙÙŠ Ø§Ù„Ø®Ø¯Ù…Ø© Ù†ØµØ¨Ø­ ÙŠØ¯Ù‹Ø§ ÙˆØ§Ø­Ø¯Ø© ÙÙŠ Ø¨Ù†Ø§Ø¡ Ù…Ø¬ØªÙ…Ø¹Ù Ø£Ù‚ÙˆÙ‰.",
      "ÙƒÙ„ Ø¹Ù…Ù„ ØµØºÙŠØ± ÙÙŠ Ø§Ù„Ø®Ø¯Ù…Ø© ÙŠÙØ­Ø³Ø¨ Ø¹Ù†Ø¯ Ø§Ù„Ù…Ø­Ø¨Ø© ÙˆØ§Ù„ÙˆÙØ§Ø¡."
    ];
    window.addEventListener('load', ()=> {
      const el = document.getElementById('serviceVerse');
      if(!el) return;
      el.textContent = verses[Math.floor(Math.random()*verses.length)];
    });
  })();

  </script>


</body>
</html>
